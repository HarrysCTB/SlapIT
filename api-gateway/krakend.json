{
  "version": 3,
  "name": "KrakenD Gateway",
  "timeout": "65s",
  "cache_ttl": "300s",
  "extra_config": {
    "github_com/devopsfaith/krakend-cors": {
      "allow_origins": ["*"],
      "allow_methods": ["GET", "POST", "DELETE", "HEAD", "OPTIONS"],
      "allow_headers": ["Authorization", "Content-Type", "Accept"],
      "expose_headers": ["Content-Type"],
      "allow_credentials": false,
      "max_age": "12h"
    }
  },
  "endpoints": [
    {
      "endpoint": "/docs",
      "method": "GET",
      "output_encoding": "no-op",
      "backend": [
        {
          "url_pattern": "/docs",
          "host": ["http://slapit-backend:8000"]
        }
      ]
    },
    {
      "endpoint": "/openapi.json",
      "method": "GET",
      "output_encoding": "no-op",
      "backend": [
        {
          "url_pattern": "/openapi.json",
          "host": ["http://slapit-backend:8000"]
        }
      ]
    },

    /* ---------- Communities ---------- */
    {
      "endpoint": "/communities/",
      "method": "POST",
      "output_encoding": "json",
      "extra_config": {
        "github_com/devopsfaith/krakend/proxy": { "read_timeout": "60s", "dial_timeout": "5s" }
      },
      "backend": [
        { "host": ["http://slapit-backend:8000"], "url_pattern": "/communities/", "method": "POST" }
      ]
    },
    {
      "endpoint": "/communities/{community_id}",
      "method": "GET",
      "output_encoding": "json",
      "backend": [
        { "host": ["http://slapit-backend:8000"], "url_pattern": "/communities/{community_id}", "method": "GET" }
      ]
    },
    {
      "endpoint": "/communities/{community_id}/join",
      "method": "POST",
      "output_encoding": "json",
      "backend": [
        { "host": ["http://slapit-backend:8000"], "url_pattern": "/communities/{community_id}/join", "method": "POST" }
      ]
    },
    {
      "endpoint": "/communities/{community_id}/quit",
      "method": "DELETE",
      "output_encoding": "json",
      "backend": [
        { "host": ["http://slapit-backend:8000"], "url_pattern": "/communities/{community_id}/quit", "method": "DELETE" }
      ]
    },
    {
      "endpoint": "/communities/{community_id}/kick",
      "method": "DELETE",
      "output_encoding": "json",
      "backend": [
        { "host": ["http://slapit-backend:8000"], "url_pattern": "/communities/{community_id}/kick", "method": "DELETE" }
      ]
    },
    {
      "endpoint": "/communities/{community_id}/users",
      "method": "GET",
      "output_encoding": "json",
      "backend": [
        { "host": ["http://slapit-backend:8000"], "url_pattern": "/communities/{community_id}/users", "method": "GET" }
      ]
    },

    /* ---------- Stickers ---------- */
    {
      "endpoint": "/stickers/",
      "method": "POST",
      "output_encoding": "json",
      "extra_config": {
        "github_com/devopsfaith/krakend/proxy": { "read_timeout": "60s", "dial_timeout": "5s" }
      },
      "backend": [
        { "host": ["http://slapit-backend:8000"], "url_pattern": "/stickers/", "method": "POST" }
      ]
    },
    {
      "endpoint": "/stickers/{sticker_id}",
      "method": "GET",
      "output_encoding": "json",
      "backend": [
        { "host": ["http://slapit-backend:8000"], "url_pattern": "/stickers/{sticker_id}", "method": "GET" }
      ]
    },
    {
      "endpoint": "/stickers/{sticker_id}",
      "method": "DELETE",
      "output_encoding": "json",
      "backend": [
        { "host": ["http://slapit-backend:8000"], "url_pattern": "/stickers/{sticker_id}", "method": "DELETE" }
      ]
    },
    {
      "endpoint": "/stickers/",
      "method": "HEAD",
      "output_encoding": "no-op",
      "backend": [
        { "host": ["http://slapit-backend:8000"], "url_pattern": "/stickers/", "method": "HEAD" }
      ]
    },

    /* ---------- Users / Profiles ---------- */
    {
      "endpoint": "/users",
      "method": "POST",
      "output_encoding": "json",
      "backend": [
        { "host": ["http://slapit-backend:8000"], "url_pattern": "/profiles", "method": "POST" }
      ]
    },
    {
      "endpoint": "/users/{auth_id}",
      "method": "GET",
      "output_encoding": "json",
      "backend": [
        { "host": ["http://slapit-backend:8000"], "url_pattern": "/users/{auth_id}", "method": "GET" }
      ]
    },

    /* ---------- Health ---------- */
    {
      "endpoint": "/health",
      "method": "GET",
      "output_encoding": "json",
      "backend": [
        { "host": ["http://slapit-backend:8000"], "url_pattern": "/health", "method": "GET" }
      ]
    }
  ]
}
